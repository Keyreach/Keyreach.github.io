<!doctype html>
<html>
<head>
<title>KUBACZ</title>
<meta charset='utf-8'>
</head>
<body>
<canvas height='480' width='640' id='kanwas'>
</canvas>
</body>
<script>
var jmp = 0;
var x = y = 3;
var kanwas = document.getElementById('kanwas');
var ktx = kanwas.getContext('2d');
ktx.fillRect(0,0,kanwas.width,kanwas.height);
var skreen = new Array();
for(i=0;i<64;i++){
	skreen[i] = new Array();
	for(j=0;j<48;j++){
		skreen[i][j] = 0;
	}
}
skreen[x][y] = 2;
function drawSkreen(){
	ktx.fillStyle = '#000';
	ktx.fillRect(0,0,kanwas.width,kanwas.height);
	for(i=0;i<64;i++){
		for(j=0;j<48;j++){
			if(skreen[i][j] == 1){
				ktx.fillStyle = "#159";
				ktx.fillRect(i*10,j*10,10,10);
			} else if(skreen[i][j] == 2){
				ktx.fillStyle = "#195";
				ktx.fillRect(i*10,j*10,10,10);
			}
		}
	}	
}
function movePc(dir){
	if(chkPos(dir)){
		skreen[x][y] = 0;
		switch(dir){
			case 0: x++; break;
			case 1: y++; break;
			case 2: x--; break;
			case 3: y--; break;
		}
		skreen[x][y] = 2;
		drawSkreen();
	}
}
function jumpEm(){
	skreen[x][y] = 0;
	for(i=0;i<6;i++){	
		alert('Jumping '+i);	
		if(skreen[x][y-i]!=0){
			break;
		}
		skreen[x][y] = 0;
		y-=5;
		skreen[x][y] = 2;
		drawSkreen();
	}
}
function chkPos(dir){
	switch(dir){
		case 0: if(skreen[x+1][y]!=0) return 0; break;
		case 1: if(skreen[x][y+1]!=0) return 0; break;
		case 2: if(skreen[x-1][y]!=0) return 0; break;
		case 3: if(skreen[x][y-1]!=0) return 0; break;
	}
	return 1;
}
function drawRundumLine(){
	lien = Math.floor(Math.random()*16)*3-1;
	a = Math.floor(Math.random()*64)
	l = Math.floor(Math.random()*(64-a));
	for(i=0;i<l;i++){
		skreen[a+i][lien] = 1;
	}
}
for(i=0;i<64;i++){
	skreen[i][47] = 1;
}
for(k=0;k<20;k++)
	drawRundumLine();
drawSkreen();
window.onkeypress = function(event){
	switch(event.keyCode){
		case 37: movePc(2); break;
		case 38: if(!chkPos(1)){ jmp = 1; setTimeout('jmp=0',2000); } break;
		case 39: movePc(0); break;
		case 40: movePc(1); break;
	}
}
setInterval('if(jmp==1) movePc(3)',250);
setInterval('if(jmp==0) movePc(1)',250);
</script>
</html>
